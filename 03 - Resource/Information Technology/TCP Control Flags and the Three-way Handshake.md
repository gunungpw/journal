# TCP Control Flags and the Three-way Handshake

As a protocol TCP establishes connections used to send long chains of segments of data. You can contrast this with the protocols that are lower in the networking model. These include IP and ethernet which just send individual packets of data. As an IT Support Specialist, you need to understand exactly how that works, so you can troubleshoot issues where network traffic may not be behaving in the expected manner. The way TCP establishes a connection is through the use of different TCP control flags used in a very specific order. Before we cover how connections are established and closed, let's first define the six TCP control flags. We'll look at them in the order that they appear in a TCP header. Heads up, this isn't necessarily in the same order of how frequently they're sent or how important they are. The first flag is known as URG. This is short for urgent. A value of one here indicates that the segment is considered urgent and that the urgent pointer field has more data about this. This feature of TCP has never really had widespread adoption and isn't normally seen.

The second flag is ACK, short for acknowledged. A value of one in this field means that the acknowledgement number field should be examined. The third flag is PSH, which is short for push. This means that the transmitting device wants the receiving device to push currently-buffered data to the application on the receiving end as soon as possible. A buffer is a computing technique where a certain amount of data is held somewhere before being sent somewhere else. This has lots of practical applications. In terms of TCP, it's used to send large chunks of data more efficiently. By keeping some amount of data in a buffer, TCP can deliver more meaningful chunks of data to the program waiting for it. But in some cases you might be sending a very small amount of information that you need the listening program to respond to immediately. This is what the push flag does.

The fourth flag is RST, short for reset. This means that one of the sides in a TCP connection hasn't been able to properly recover from a series of missing or malformed segments. It's a way for one of the partners in a TCP connection to basically say, wait, I can't put together what you mean, let's start over from scratch. The fifth flag is SYN, which stands for synchronize. It's used when first establishing a TCP connection and make sure the receiving end knows to examine the sequence number field. And finally our sixth flag is FIN, which is short for finish. When this flag is sent to one, it means the transmitting computer doesn't have any more data to send and the connection can be closed. For a good example of how TCP control flags are used, let's check out how a TCP connection is established. Computer A will be our transmitting computer and computer B will be our receiving computer. To start the process off computer A sends a TCP segment to Computer B, with a SYN flag sent. This is computer A's way of saying, let's establish a connection and look at my sequence number field so we know where this conversation starts. Computer B then responds with a TCP segment where both the SYN and ACK flags are sent. This is Computer B's way of saying, sure, let's establish a connection and I acknowledge your sequence number. Then Computer A responds again with just the ACK flag sent, which is just saying I acknowledge your acknowledgement, let's start sending data. I love how polite they are to each other. This exchange involving segments that have SYN, SYN/ACK and ACK sent happens every single time a TCP connection is established anywhere and is so famous that it has a nickname. The three-way handshake. A handshake is a way for two devices to ensure that they're speaking the same protocol and will be able to understand each other. Once the three-way handshake is complete, the TCP connection is established. Now, Computer A is free to send whatever data it wants to Computer B and vice versa. Since both sides have now sent SYN/ACK pairs to each other, a TCP connection in this state is operating in full duplex. Each segment sent in either direction should be responded to by a TCP segment with the ACK field sent. This way the other side always knows what has been received. Once one of the devices involved with the TCP connection is ready to close the connection, something known as a four-way handshake happens. The computer ready to close the connection sends a FIN flag, which the other computer acknowledges with an ACK flag. Then if this computer is also ready to close the connection, which will almost always be the case, it will send a FIN flag. This is again responded to by an ACK flag. Hypothetically, a TCP connection can stay open in simplex mode with only one side closing the connection, but this isn't something you'll run into very often.

â€‹
